var request = require('request')
  , test = require('tape')

var cli = require('../lib/cli')

test('max listeners is no longer triggered', function(assert) {
  var pending = 1000

  cli(['node', 'beefy', 'test/fixture.js:bundle.js'], function(err, server) {
    assert.ok(!err)

    for(var i = 0; i < pending; ++i) {
      request('http://localhost:9966/bundle.js', onresponse)
    }

    console.log('fak')

    function onresponse(err, resp, body) {
      if(!--pending) {
        return server.close(function() {
          assert.end()
        })
      }
    }
  })
})
